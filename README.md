# MyPlugin TerraAngel插件模板

- 作者: 羽学
- 出处: [TerraAngel-PLUGINS](https://github.com/UnrealMultiple/TerraAngel/blob/master/PLUGINS.md)
- 这是一个TerraAngel插件模板，集成了配置文件与重载功能、自动回血的控制台指令编写教学。

## 更新日志

```
v1.1.2
自定义配方不再需要合成站,移除合成站添加窗口
加入了NPC自动对话功能，当靠近NPC时自动弹出聊天窗口(有商店的自动打开商店)
插件初始化时可获取到当前地图信息（地图名、大小、难度、进度、ID）
修复移除配方时不会删除游戏内配方BUG
修复重新添加和保存相同物品配方时无法更新配方材料BUG
注意：配方异常时请重启TerraAngel并删除本插件的配置文件来恢复
NPC自动对话等待时间从秒改为帧数
添加了税收官随机奖励物品功能
fix:
修复自动对话玩家距离NPC格数不准确的BUG
修复自动对话护士不会主动治疗的BUG,并减少治疗费用
修复清理渔夫任务在自动对话无法生效
现清理渔夫任务不再使用Update()方法触发，直接按Esc关闭对话窗口(不再消耗任务鱼)
移除清理渔夫任务间隔配置项(开启对话框立即刷新)

v1.1.1
优化窗口排版
给连锁挖矿与生成NPC使用独立窗口
加入了加载世界收藏物品
加入了配方检查事件
在物品管理分支加入配方管理器支持修改添加新配方

v1.1.0
加入了图格编辑事件与连锁挖矿功能

v1.0.9
加入了NPC更新事件，NPC管理功能（支持自动回血/复活城镇npc/生成指定npc）
优化入侵事件管理器逻辑
优化了自动使用物品、自动垃圾桶、鼠标范围伤害npc采用游戏帧计算（节省计算开销）

v1.0.8
加入了事件管理器，支持控制：
血月、日食、灯笼夜、南瓜月、霜月、满月
下雨、史莱姆雨、沙尘暴、时间、陨石、所有入侵事件
给传送管理加入了陨石传送功能
加入了自动清渔夫任务功能

v1.0.7
加入定位传送功能,支持传送：
出生点/床/死亡地点/自定义传送点/城镇NPC
宝藏袋/微光湖/神庙祭坛/世纪花苞/地牢门口

v1.0.6
加入自动垃圾桶功能
优化了CopyPlugin脚本,支持相对路径下：
自动复制插件到插件识别目录并删除旧配置文件
给自动垃圾桶加入了临时排除功能
移除自动垃圾桶的添加按钮改为“搜索”功能
重构物品编辑管理窗口,使用与自动垃圾桶类似的搜索功能

v1.0.5
加入了反重力药水功能（不会反转屏幕）
fix:
修复一键收藏不会收藏最后一个物品的问题
修复初始化获取不到钩子方法导致空引用的问题
修复无法杀死服务器中鼠标范围内的NPC

v1.0.4
此版本需要添加MonoMod相关的依赖项（using.zip里有）
加入了装饰栏饰品生效功能(可选择应用:盔甲防御/饰品功能性/前缀加成)
优化了一键收藏:对新物品状态统一后再反转状态

v1.0.3 (此版本对我意义重大,在我完成更新时,我父亲已经离开人世)
加入了打开物品管理器时的音效播放  
优化了物品管理器的模糊搜索功能  
加入了常见的物品修改参数(渔力/镐斧锤力/放置图格或墙ID等)  
加入了一键修改饰品栏前缀（仅适配大师难度）  
加入了一键收藏背包虚空袋物品  

v1.0.2
加入了自动使用物品功能（将鼠标范围伤害放入其中作为子功能）
加入了物品管理编辑器，方便于修改物品属性
UI代码逻辑简化，容易添加自己需要的物品属性

v1.0.1
新增添加UI方法与自定义按键触发相对功能
给自杀功能加入了死亡判断，死亡时使用则为立即复活
加入了使用物品时对范围内NPC造成手上武器的伤害(可自定义范围格数)
加入个CopyPlugin.cmd小脚本,用于《生成后事件》自动复制插件到插件目录
只需在游戏控制台使用指令即可完成功能重载：#reload_plugins

v1.0.0
实现配置文件重读，添加Reload指令
实现指令启用自动回血功能
```

## 指令

| 语法                             | 指令  |       权限       |                   说明                   |
| -------------------------------- | :---: | :--------------: | :--------------------------------------: |
| heal  | #heal 数值 |  无    |    启用禁用按键回血（可定义回血数值）    |
| kill  | #kill |  无    |    自杀与复活功能    |
| snpc  | #snpc |  无    |    启用鼠标范围伤害(可定义范围格数)    |
| autouse  | #autouse |  无    |    自动使用物品(可定义间隔)    |
| reload  | #reload |   无    |    重载配置文件    |

## 配置
> 配置文件位置：D:\Documents\MyGames\Terraria\TerraAngel\MyPlugin.json
```json
{
  "插件开关": true,
  "回血按键": 72,
  "开启快捷键回血": true,
  "回血值": 100,
  "自杀复活按键": 75,
  "快速自杀复活": true,
  "自动使用按键": 74,
  "自动使用物品": false,
  "使用间隔(帧)": 10,
  "鼠标范围伤害NPC": false,
  "鼠标范围伤害值": 0,
  "鼠标伤害NPC格数": 3,
  "鼠标伤害间隔(帧)": 30,
  "修改前缀按键": 80,
  "快速收藏按键": 79,
  "社交栏饰品开关按键": 78,
  "社交栏饰品加成开关": false,
  "恢复前缀加成": true,
  "恢复盔甲防御": true,
  "恢复饰品功能": true,
  "物品修改": true,
  "应用修改按键": 73,
  "修改物品": [],
  "忽略重力药水按键": 84,
  "忽略重力药水": true,
  "自动垃圾桶按键": 67,
  "自动垃圾桶": false,
  "自动垃圾桶同步间隔": 10,
  "自动垃圾桶表": [],
  "自定义传送点": {},
  "清除钓鱼任务按键": 70,
  "清除钓鱼任务间隔(帧)": 120,
  "清除钓鱼任务": false,
  "NPC自动回血按键": 0,
  "NPC自动回血": false,
  "普通NPC回血百分比": 1.0,
  "普通NPC回血间隔(秒)": 1,
  "允许Boss回血": false,
  "BOSS回血百分比": 0.1,
  "BOSS每次回血上限": 1000,
  "BOSS独立回血间隔(秒)": 3,
  "NPC复活按键": 36,
  "连锁挖矿按键": 86,
  "连锁挖矿开关": false,
  "连锁挖矿上限": 500,
  "连锁图格表": [
    {
      "TileID": 6,
      "ItemName": "铁矿"
    },
    {
      "TileID": 7,
      "ItemName": "铜矿"
    },
    {
      "TileID": 8,
      "ItemName": "金矿"
    },
    {
      "TileID": 9,
      "ItemName": "银矿"
    },
    {
      "TileID": 22,
      "ItemName": "魔矿"
    },
    {
      "TileID": 37,
      "ItemName": "陨石"
    },
    {
      "TileID": 48,
      "ItemName": "尖刺"
    },
    {
      "TileID": 56,
      "ItemName": "黑曜石"
    },
    {
      "TileID": 58,
      "ItemName": "狱石"
    },
    {
      "TileID": 63,
      "ItemName": "蓝玉石块"
    },
    {
      "TileID": 64,
      "ItemName": "红玉石块"
    },
    {
      "TileID": 65,
      "ItemName": "翡翠石块"
    },
    {
      "TileID": 66,
      "ItemName": "黄玉石块"
    },
    {
      "TileID": 67,
      "ItemName": "紫晶石块"
    },
    {
      "TileID": 68,
      "ItemName": "钻石石块"
    },
    {
      "TileID": 107,
      "ItemName": "钴矿"
    },
    {
      "TileID": 108,
      "ItemName": "秘银矿"
    },
    {
      "TileID": 111,
      "ItemName": "精金矿"
    },
    {
      "TileID": 166,
      "ItemName": "锡矿"
    },
    {
      "TileID": 167,
      "ItemName": "铅矿"
    },
    {
      "TileID": 168,
      "ItemName": "钨矿"
    },
    {
      "TileID": 169,
      "ItemName": "铂金矿"
    },
    {
      "TileID": 204,
      "ItemName": "猩红矿"
    },
    {
      "TileID": 211,
      "ItemName": "叶绿矿"
    },
    {
      "TileID": 221,
      "ItemName": "钯金矿"
    },
    {
      "TileID": 222,
      "ItemName": "山铜矿"
    },
    {
      "TileID": 223,
      "ItemName": "钛金矿"
    },
    {
      "TileID": 229,
      "ItemName": "蜂蜜块"
    },
    {
      "TileID": 230,
      "ItemName": "松脆蜂蜜块"
    },
    {
      "TileID": 232,
      "ItemName": "木尖刺"
    },
    {
      "TileID": 404,
      "ItemName": "沙漠化石"
    }
  ],
  "进入世界收藏背包物品": true,
  "解锁所有配方": false,
  "忽略工作站要求": false,
  "添加自定义配方": true,
  "自定义配方列表": [
    {
      "UniqueID": "5f987edc-49ad-40ac-b0b6-361c1c47bbc9",
      "Index": -1,
      "ResultItem": 8,
      "ResultStack": 1,
      "Ingredients": [
        {
          "ItemId": 2,
          "Stack": 1
        }
      ],
      "RequiredTile": [],
      "IsAlchemyRecipe": false
    }
  ],
  "NPC自动对话按键": 89,
  "NPC自动对话": true,
  "NPC自动对话的最小格数": 2,
  "NPC自动对话等待秒数": 3
}
```